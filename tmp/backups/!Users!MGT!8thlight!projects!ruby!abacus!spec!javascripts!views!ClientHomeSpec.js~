describe("Abacus.Views.ClientHome", function() {
  
  beforeEach(function() {
    Abacus.Models.Project.prototype.getClientList = function() {
      return [{id: 5, name: 'IBM'}];
    };
    
    loadFixtures('_client.html', '_project.html');
    this.model = new Abacus.Models.Client({
      id: 5, 
      name: 'IBM',
      projects: [{
        name: 'p1',
        id: 1
      },
      {
        name: 'p2',
        id: 2
      }]
    });
    this.view = new Abacus.Views.Client({model: this.model});
  });

  describe("rendering", function() {
    it("renders the related projects along with the client", function() {
      sinon.spy(this.view, 'childViews');
      this.view.render(); 
      expect(this.view.childViews).toHaveBeenCalled();
      expect(this.view.$('.projects li').length).toBe(2);
    });
  });
  
  describe("delete", function() {
    it("calls its model's destroy function on click", function() {
      sinon.spy(this.view.model, 'destroy');
      this.view.render();
      this.view.$('.delete').click();
      
      expect(this.view.model.destroy).toHaveBeenCalled();
    });
  });
