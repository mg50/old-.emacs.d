namespace("Abacus.Views", {
  ProjectCreate: Abacus.Views.MustacheInDialogView.extend({
    el: '#modal',
    template: 'project_new',

    events: {
      'click .submit': 'add',
      'click .cancel': 'cancel'
    },

    presenterData: function() {
      return this.model.attributes;
    },

    add: function(event) {
      event.preventDefault();
      event.stopPropagation();

      this.addProject();
    },

    addProject: function() {
      var attributes = this.getAttributes();
      attributes.client_id = this.model.get('client_id');
      this.collection.create(attributes, {at: 0});
      this.close();
    },

    getAttributes: function() {
      var attributes = {};
      this
        .$el
        .find('.attribute')
        .each(function () {
          var input = $(this);
          attributes[input.attr('name')] = input.attr('value');
        });

      this
        .$el
        .find('input[type="radio"]:checked')
        .each(function () {
          var input = $(this);
          attributes[input.attr('name')] = input.attr('value');
        });

      return attributes;
    },

    cancel: function(event) {
      event.preventDefault();
      event.stopPropagation();

      this.close();
    }
  })
});
