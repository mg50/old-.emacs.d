require 'client/client_dbadapter'
require 'client/client_interactor'

class ClientsController < ApplicationController

  before_filter :set_interactor
  before_filter :admin_required

  def index
    callback = lambda { |all|
      respond_to do |format|
        format.html { render :action => "index", :locals => {:all => all} }
        format.json {
          render :json => all.to_json(
            :include => {
              :contacts => {},
              :projects => {
                :include => :project_note
              }
            }
          )
        }
      end
    }

    @interactor.find_all(callback)
  end

  def show
    id = params[:id]
    callback = lambda { |client|
      render :json => client.to_json
    }

    @interactor.find(id, callback);
  end

  def create
    attrs = params[:client]
    callback = lambda { |client|
      render :json => client.to_json
    }
    @interactor.create(attrs, callback)
  end

  def update
    id = params[:id].to_i
    attributes = params[:client]
    callback = lambda { |client| render :json => client.to_json }
    @interactor.update(id, attributes, callback)
  end

  private

  def set_interactor
    @interactor = Interactor::Client.new
  end
end
